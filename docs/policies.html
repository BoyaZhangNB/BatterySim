<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <title>Charging Policies & Mechanisms</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />

    <!-- Shared stylesheet -->
    <link rel="stylesheet" href="style.css" />

    <!-- MathJax -->
    <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
    <script id="MathJax-script" async
        src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>

    <style>
        .policy-section, .mech-section {
            margin-bottom: 40px;
        }

        .card p, li {
            line-height: 1.55;
            color: var(--subtext);
        }
    </style>
</head>

<body>

    <!-- Charging bar -->
    <div id="charging-bar">
        <div id="charging-fill"></div>
    </div>

    <!-- Header -->
    <header>
    <nav>
        <div class="title">
            <div class="batt-nav"><div class="batt-fill"></div></div>
            <span>BatterySim ODE Project</span>
        </div>
        <ul>
            <li><a href="index.html">Home</a></li>
            <li><a href="policies.html" style="color: var(--accent)">Policies &amp; Mechanisms</a></li>
            <li><a href="equations.html">Equations</a></li>
            <li><a href="simulate.html">Simulation</a></li>
            <li><a href="code.html">Code</a></li>
        </ul>
    </nav>
</header>


    <section class="policy-section">
        <h2>Charging Policies</h2>
        <p>
            Charging policies describe how the **source voltage** is computed at each timestep.
            Each policy class implements:
        </p>
        <p>
            <code>get_voltage(t, y)</code>  
            where \( y = [V, I, R, T, \text{SOC}, \text{SEI}, V_{transient}] \)
        </p>

        <!-- Constant Voltage -->
        <div class="card">
            <h3>1. Constant Voltage (CV)</h3>
            <p>Applies a fixed voltage during the charge cycle.</p>
            <p>
                \[
                    V_{\text{source}}(t) = V_{set}
                \]
            </p>
            <p>
                In code:
                <pre>return self.voltage</pre>
            </p>
        </div>

        <!-- Constant Current -->
        <div class="card">
            <h3>2. Constant Current (CC)</h3>
            <p>Adjusts the source voltage to maintain a desired current.</p>
            <p>
                \[
                    V_{\text{source}}(t) = I_{set} \cdot R(t) + \text{OCV}(\text{SOC}(t))
                \]
            </p>
            <p>Matches real-world CC charging through voltage regulation.</p>
        </div>

        <!-- Pulse charging -->
        <div class="card">
            <h3>3. Pulse Charging</h3>
            <p>
                Alternates between charging at a fixed current and resting.
            </p>
            <p>
                \[
                    V_{\text{source}}(t) =
                    \begin{cases}
                        I_{set} \cdot R(t) + \text{OCV}, & (t \bmod (t_{on}+t_{off})) < t_{on} \\
                        \text{OCV}, & \text{otherwise}
                    \end{cases}
                \]
            </p>
        </div>

        <!-- Sinusoidal -->
        <div class="card">
            <h3>4. Sinusoidal Charging</h3>
            <p>Uses a sinusoidally varying current magnitude.</p>
            <p>
                \[
                    V_{\text{source}}(t) =
                    | I_{set} \sin(2\pi f t) | \cdot R(t) + \text{OCV}
                \]
            </p>
        </div>

        <!-- Constant Current - Constant Voltage -->
        <div class="card">
            <h3>5. Constant Current → Constant Voltage (CCCV)</h3>
            <p>A two-stage charging strategy combining CC and CV phases:</p>
            <ul>
                <li><strong>Stage 1 (CC):</strong> Constant current until battery voltage reaches target</li>
                <li><strong>Stage 2 (CV):</strong> Constant voltage with decreasing current as battery fills</li>
            </ul>
            <p>
                \[
                    V_{\text{source}}(t) =
                    \begin{cases}
                        I_{set} \cdot R(t) + \text{OCV}, & \text{OCV} < V_{CV} \\
                        V_{CV}, & \text{OCV} \geq V_{CV}
                    \end{cases}
                \]
            </p>
            <p><strong>Real-world usage:</strong> Standard charging in smartphones and EVs.</p>
        </div>

        <!-- CC-CV-Pulse -->
        <div class="card">
            <h3>6. CC → CV → Pulse (CCCVPulse)</h3>
            <p>A three-stage advanced charging strategy:</p>
            <ul>
                <li><strong>Stage 1 (CC):</strong> High current charging from 0-80% SoC</li>
                <li><strong>Stage 2 (CV):</strong> Constant voltage from 80-95% SoC for safety</li>
                <li><strong>Stage 3 (Pulse):</strong> Low-frequency pulses for final 5% topping</li>
            </ul>
            <p>
                \[
                    V_{\text{source}}(t) =
                    \begin{cases}
                        I_{CC} \cdot R(t) + \text{OCV}, & \text{SOC} < 0.80 \\
                        V_{CV}, & 0.80 \leq \text{SOC} < 0.95 \\
                        I_{pulse}|\sin(2\pi f t)| \cdot R(t) + \text{OCV}, & \text{SOC} \geq 0.95
                    \end{cases}
                \]
            </p>
            <p><strong>Real-world usage:</strong> Premium fast chargers (Samsung, OnePlus, Tesla).</p>
        </div>

        <!-- CV-Pulse -->
        <div class="card">
            <h3>7. Constant Voltage → Pulse (CVPulse)</h3>
            <p>A two-stage strategy starting from constant voltage with pulse optimization:</p>
            <ul>
                <li><strong>Stage 1 (CV):</strong> Constant voltage charging (constant endpoint voltage)</li>
                <li><strong>Stage 2 (Pulse):</strong> Low-amplitude pulses during CV phase</li>
            </ul>
            <p>
                \[
                    V_{\text{source}}(t) = V_{CV} + I_{pulse}|\sin(2\pi f t)| \cdot \epsilon
                \]
            </p>
            <p>where \(\epsilon\) is a small modulation amplitude.</p>
            <p><strong>Use case:</strong> Optimizing CV-based charging with reduced stress.</p>
        </div>
    </section>

    <!-- Mechanisms -->
    <section class="mech-section">
        <h2>Policy Comparison Results</h2>
        <p>
            Simulation results for a 3 Ah battery comparing all charging policies using 
            <strong>fair comparison criteria</strong>: all policies target the same final 
            voltage (4.0V) to ensure consistent endpoints.
        </p>
        
        <div class="card">
            <h3>Performance Metrics (3 Ah Battery)</h3>
            <table style="width: 100%; border-collapse: collapse; margin: 15px 0;">
                <thead>
                    <tr style="background: rgba(34,211,238,0.1); border-bottom: 2px solid rgba(34,211,238,0.3);">
                        <th style="padding: 10px; text-align: left; border: 1px solid rgba(148,163,184,0.3);">Policy</th>
                        <th style="padding: 10px; text-align: center; border: 1px solid rgba(148,163,184,0.3);">Time (hrs)</th>
                        <th style="padding: 10px; text-align: center; border: 1px solid rgba(148,163,184,0.3);">Peak Temp (K)</th>
                        <th style="padding: 10px; text-align: center; border: 1px solid rgba(148,163,184,0.3);">Avg Temp (K)</th>
                        <th style="padding: 10px; text-align: center; border: 1px solid rgba(148,163,184,0.3);">SEI Growth</th>
                    </tr>
                </thead>
                <tbody>
                    <tr style="border-bottom: 1px solid rgba(148,163,184,0.2);">
                        <td style="padding: 10px; border: 1px solid rgba(148,163,184,0.2);"><strong>CC_20A</strong></td>
                        <td style="padding: 10px; text-align: center; border: 1px solid rgba(148,163,184,0.2);">0.1876</td>
                        <td style="padding: 10px; text-align: center; border: 1px solid rgba(148,163,184,0.2);">305.85</td>
                        <td style="padding: 10px; text-align: center; border: 1px solid rgba(148,163,184,0.2);">303.12</td>
                        <td style="padding: 10px; text-align: center; border: 1px solid rgba(148,163,184,0.2);">2.51e-10</td>
                    </tr>
                    <tr style="border-bottom: 1px solid rgba(148,163,184,0.2);">
                        <td style="padding: 10px; border: 1px solid rgba(148,163,184,0.2);"><strong>CV_4.2V</strong></td>
                        <td style="padding: 10px; text-align: center; border: 1px solid rgba(148,163,184,0.2);">0.1174</td>
                        <td style="padding: 10px; text-align: center; border: 1px solid rgba(148,163,184,0.2);">357.58</td>
                        <td style="padding: 10px; text-align: center; border: 1px solid rgba(148,163,184,0.2);">311.64</td>
                        <td style="padding: 10px; text-align: center; border: 1px solid rgba(148,163,184,0.2);">3.38e-10</td>
                    </tr>
                    <tr style="border-bottom: 1px solid rgba(148,163,184,0.2);">
                        <td style="padding: 10px; border: 1px solid rgba(148,163,184,0.2);"><strong>CCCV_20A_4.0V</strong></td>
                        <td style="padding: 10px; text-align: center; border: 1px solid rgba(148,163,184,0.2);">0.1877</td>
                        <td style="padding: 10px; text-align: center; border: 1px solid rgba(148,163,184,0.2);">305.82</td>
                        <td style="padding: 10px; text-align: center; border: 1px solid rgba(148,163,184,0.2);">303.12</td>
                        <td style="padding: 10px; text-align: center; border: 1px solid rgba(148,163,184,0.2);">2.51e-10</td>
                    </tr>
                    <tr style="border-bottom: 1px solid rgba(148,163,184,0.2);">
                        <td style="padding: 10px; border: 1px solid rgba(148,163,184,0.2);"><strong>CCCVPulse_20A_4.0V</strong></td>
                        <td style="padding: 10px; text-align: center; border: 1px solid rgba(148,163,184,0.2);">0.2504</td>
                        <td style="padding: 10px; text-align: center; border: 1px solid rgba(148,163,184,0.2);">305.82</td>
                        <td style="padding: 10px; text-align: center; border: 1px solid rgba(148,163,184,0.2);">301.75</td>
                        <td style="padding: 10px; text-align: center; border: 1px solid rgba(148,163,184,0.2);">2.76e-10</td>
                    </tr>
                    <tr style="border-bottom: 1px solid rgba(148,163,184,0.2);">
                        <td style="padding: 10px; border: 1px solid rgba(148,163,184,0.2);"><strong>CVPulse_4.2V</strong></td>
                        <td style="padding: 10px; text-align: center; border: 1px solid rgba(148,163,184,0.2);">0.1011</td>
                        <td style="padding: 10px; text-align: center; border: 1px solid rgba(148,163,184,0.2);">370.12</td>
                        <td style="padding: 10px; text-align: center; border: 1px solid rgba(148,163,184,0.2);">316.40</td>
                        <td style="padding: 10px; text-align: center; border: 1px solid rgba(148,163,184,0.2);">3.99e-10</td>
                    </tr>
                </tbody>
            </table>
        </div>

        <div class="card">
            <h3>Key Insights</h3>
            <ul>
                <li><strong>Fastest:</strong> CVPulse (0.101 hrs) - but highest peak temperature and SEI</li>
                <li><strong>Safest:</strong> CC_20A & CCCV_20A (lowest temperatures and SEI)</li>
                <li><strong>Best Balance:</strong> CCCVPulse (reasonable speed with excellent thermal management)</li>
                <li><strong>CC vs CCCV Equivalence:</strong> Both 20A policies virtually identical—battery reaches 4.0V exactly at 100% SoC</li>
            </ul>
        </div>
    </section>

    <!-- Mechanisms -->
    <section class="mech-section">
        <h2>Battery Mechanisms</h2>
        <p>
            These physical mechanisms produce the ODEs governing voltage, temperature, SOC, SEI, and transient behavior.
        </p>

        <!-- CHARGING MECHANISM -->
        <div class="card">
            <h3>1. Charging Mechanism (SOC Update)</h3>
            <p>
                The SOC evolves via:
                \[
                    \frac{d\,\text{SOC}}{dt} = \frac{I(t)}{C_{\text{nominal}} \cdot 3600}
                \]
            </p>
        </div>

        <!-- THERMO -->
        <div class="card">
            <h3>2. Thermal Mechanism</h3>
            <p>Sums ohmic heating and cooling to ambient temperature.</p>
            <p>
                Ohmic heating:
                \[
                    \frac{dT}{dt} = \frac{I^2 R}{m c}
                \]
            </p>
            <p>
                Cooling:
                \[
                    \frac{dT}{dt} = -k(T - T_{amb})
                \]
            </p>
        </div>

        <!-- SEI Simplified -->
        <div class="card">
            <h3>3. SEI (Simplified Model)</h3>
            <p>
                Growth rate governed by Arrhenius temperature scaling and
                SOC/current stress.
            </p>
            <p>
                \[
                    k_T = k_0 e^{-E_a / (RT)}
                \]
            </p>
            <p>
                Stress term:
                \[
                    f_{QI} = (1+2\,\text{SOC}^2)(1 + 0.1|I|)
                \]
            </p>
            <p>
                Combined:
                \[
                    \frac{d(\text{SEI})}{dt} = k_T f_{QI}
                \]
            </p>
        </div>

        <!-- SEI Full Model -->
        <div class="card">
            <h3>4. SEI (Full Model)</h3>
            <p>
                Includes dependence on anode potential, current nonlinearity,
                and exponential SOC scaling.
            </p>
            <p>
                \[
                    f_{QI} = 
                    A \exp\left(\gamma_{\text{soc}}(U_{ref} - U_{ocv})\right)
                    \left(1 + \beta_I |I| \right)^\nu
                \]
            </p>
            <p>
                \[
                    \frac{d(\text{SEI})}{dt}
                    = k_0 e^{-E_a/(RT)} \;\; f_{QI}
                \]
            </p>
        </div>

        <!-- TRANSIENT -->
        <div class="card">
            <h3>5. Transient RC Mechanism</h3>
            <p>
                Models overpotential dynamics using an RC circuit:
                \[
                    \frac{dV_c}{dt} = -\frac{1}{RC} V_c + \frac{1}{C} I
                \]
            </p>
        </div>
    </section>

    <footer>
        © 2025 BatterySim ODE Project
    </footer>

    <!-- Scroll animations -->
    <script>
        document.addEventListener("scroll", () => {
            const scrollY = window.scrollY;
            const docHeight = document.body.scrollHeight - window.innerHeight;
            const progress = docHeight > 0 ? (scrollY / docHeight) * 100 : 0;

            const fill = document.getElementById("charging-fill");
            if (fill) fill.style.height = progress + "%";

            document.querySelectorAll("section").forEach(sec => {
                const rect = sec.getBoundingClientRect();
                if (rect.top < window.innerHeight - 80) {
                    sec.classList.add("visible");
                }
            });
        });

        window.addEventListener("load", () => {
            document.dispatchEvent(new Event("scroll"));
        });
    </script>
</body>
</html>
