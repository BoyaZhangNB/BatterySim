<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <title>Equations & ODE System</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />

    <!-- Shared stylesheet -->
    <link rel="stylesheet" href="style.css" />

    <!-- MathJax for equations -->
    <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
    <script id="MathJax-script" async
        src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>

    <style>
        .equations section p,
        .equations section li {
            line-height: 1.6;
        }

        .equations h3 {
            margin-top: 0;
        }
    </style>
</head>

<body class="equations">

    <!-- Charging bar -->
    <div id="charging-bar">
        <div id="charging-fill"></div>
    </div>

    <!-- Header -->
    <header>
    <nav>
        <div class="title">
            <div class="batt-nav"><div class="batt-fill"></div></div>
            <span>BatterySim ODE Project</span>
        </div>
        <ul>
            <li><a href="index.html">Home</a></li>
            <li><a href="policies.html">Policies &amp; Mechanisms</a></li>
            <li><a href="equations.html" style="color: var(--accent)">Equations</a></li>
            <li><a href="simulate.html">Simulation</a></li>
            <li><a href="code.html">Code</a></li>
        </ul>
    </nav>
</header>


    <!-- State Vector -->
    <section id="state-vector">
        <h2>State Vector</h2>
        <p>
            The simulation uses a packed state vector
        </p>
        <p>
            \[
            y = \begin{bmatrix}
            V \\ I \\ R \\ T \\ SOC \\ SEI
            \end{bmatrix},
            \]
        </p>
        <p>
            where
        </p>
        <p>
        \[
        \begin{aligned}
        V &: \text{ terminal / OCV voltage (V)}, \\
        I &: \text{ current into the battery (A)}, \\
        R &: \text{ internal resistance (}\Omega\text{)}, \\
        T &: \text{ temperature (K)}, \\
        SOC &: \text{ state of charge (0–1)}, \\
        SEI &: \text{ SEI layer thickness (arb. units)}, \ \
        V_c &: \text{ transient RC voltage (V)}.
        \end{aligned}
        \]
        </p>

        <p>
            The full ODE system is written as a sum over mechanism contributions:
        </p>
        <p>
        \[
            \frac{dy}{dt}
            = \sum_{\text{mechanisms}} \frac{dy}{dt}^{(\text{mech})}.
        \]
        </p>
    </section>

    <!-- Charging Model (SOC) -->
    <section id="charging-model">
        <h2>Charging Model (SOC Dynamics)</h2>

        <h3>Differential Equation</h3>
        <p>
        \[
            \frac{dSOC}{dt} = \frac{I}{C_{\text{nominal}} \cdot 3600}
        \]
        </p>
        <p>
            All other partial derivatives from this mechanism are zero.
        </p>

        <h3>Parameters</h3>
        <p>
        \[
        \begin{aligned}
        C_{\text{nominal}} &: \text{ nominal capacity (Ah)}, \\
        3600 &: \text{ seconds per hour}.
        \end{aligned}
        \]
        </p>
    </section>

    <!-- Thermal Model -->
    <section id="thermal-model">
        <h2>Thermal Model</h2>

        <h3>Ohmic Heating</h3>
        <p>
        \[
            \left(\frac{dT}{dt}\right)_{\text{ohmic}} 
            = \frac{I^2 R}{m c}
        \]
        </p>

        <h3>Overpotential Heating</h3>
        <p>
        \[
            \left(\frac{dT}{dt}\right)_{\text{overpotential}}
            = \frac{I\,(V_{\text{source}} - V)}{m c}
        \]
        </p>

        <h3>Cooling (Newton's Law)</h3>
        <p>
        \[
            \left(\frac{dT}{dt}\right)_{\text{cooling}}
            = -k(T - T_{\text{amb}})
        \]
        </p>

        <h3>Total Temperature ODE</h3>
        <p>
        \[
            \frac{dT}{dt} =
            \frac{I^2 R}{m c}
            + \frac{I\,(V_{\text{source}} - V)}{m c}
            - k(T - T_{\text{amb}})
        \]
        </p>

        <h3>Parameters</h3>
        <p>
        \[
        \begin{aligned}
        m &: \text{ mass (kg)}, \\
        c &: \text{ specific heat (J/(kg K))}, \\
        k &: \text{ cooling constant (1/s)}, \\
        T_{\text{amb}} &: \text{ ambient temperature (K)}.
        \end{aligned}
        \]
        </p>
    </section>

    <!-- SEI Full -->
    <section id="sei-full">
        <h2>SEI Growth Model (Full Version)</h2>

        <h3>Arrhenius Temperature Factor</h3>
        <p>
        \[
            f_T(T) = \exp\left(-\frac{E_a}{R_{\text{gas}} T}\right)
        \]
        </p>

        <h3>Stress Function</h3>
        <p>
            The effective anode potential is:
        </p>
        <p>
        \[
            U = \begin{cases}
            U_{\text{ocv}}, & \text{if supplied} \\
            U_{\text{ref}} \cdot SOC, & \text{otherwise}
            \end{cases}
        \]
        </p>
        <p>
        \[
            \text{exponent} = \gamma_{\text{soc}} (U_{\text{ref}} - U)
        \]
        </p>
        <p>
        \[
            \text{current\_term} = \left(1 + \beta_I |I|\right)^{\nu}
        \]
        </p>
        <p>
            Stress multiplier:
        </p>
        <p>
        \[
            f_{QI}(SOC,I,U) =
            A \exp\left(\gamma_{\text{soc}} (U_{\text{ref}} - U)\right)
            \left(1 + \beta_I |I|\right)^{\nu}
        \]
        </p>

        <h3>SEI Growth ODE</h3>
        <p>
        \[
            k_T = k_0 \exp\left(-\frac{E_a}{R_{\text{gas}}T}\right)
        \]
        </p>
        <p>
        \[
            \frac{dSEI}{dt} = k_T \, f_{QI}(SOC,I,U)
        \]
        </p>

        <h3>Parameters</h3>
        <p>
        \[
        \begin{aligned}
        k_0 &: \text{ SEI rate prefactor (m/s or a.u.)}, \\
        E_a &: \text{ activation energy (J/mol)}, \\
        R_{\text{gas}} &: 8.314 \text{ (J/mol K)}, \\
        A &: \text{ scaling factor}, \\
        \gamma_{\text{soc}} &: \text{ SOC/potential sensitivity}, \\
        \beta_I &: \text{ current influence factor}, \\
        \nu &: \text{ current exponent}, \\
        U_{\text{ref}} &: \text{ reference potential (V)}.
        \end{aligned}
        \]
        </p>
    </section>

    <!-- Simplified SEI -->
    <section id="sei-simplified">
        <h2>Simplified SEI Model</h2>

        <h3>Stress Function</h3>
        <p>
        \[
            \text{soc\_factor} = \max(0,\min(1,SOC))
        \]
        </p>
        <p>
        \[
            \text{current\_factor} = |I|
        \]
        </p>
        <p>
        \[
            f_{QI}(SOC,I) = (1 + 2\,\text{soc\_factor}^2)(1 + 0.1|I|)
        \]
        </p>

        <h3>SEI ODE</h3>
        <p>
        \[
            \frac{dSEI}{dt} = k_0 \exp\left( -\frac{E_a}{R_{\text{gas}}T} \right)
            (1 + 2 SOC^2)(1 + 0.1|I|)
        \]
        </p>
    </section>

    <!-- Algebraic Updates -->
    <section id="algebraic-updates">
        <h2>Algebraic State Updates</h2>
        <p>
            These updates are applied each timestep before integration.
        </p>

        <h3>Current Update</h3>
        <p>
        \[
            I_{\text{new}}
            = \frac{V_{\text{source}} - V}{R}
        \]
        </p>

        <h3>Temperature-Dependent Resistance Update</h3>
        <p>
        \[
            R_{\text{new}}
            = R_0 \exp\left(
            \frac{E_a}{k}\left(
            \frac{1}{T} - \frac{1}{T_{\text{ref}}}
            \right)
            \right)
        \]
        </p>
        <p>
        \[
        \begin{aligned}
        R_0 &: \text{ initial resistance (}\Omega\text{)}, \\
        E_a &: 0.7 \text{ (eV)}, \\
        k &: 8.314 \text{ (eV/K)}, \\
        T_{\text{ref}} &: 298 \text{ (K)}.
        \end{aligned}
        \]
        </p>

        <h3>OCV From SOC (Table Interpolation)</h3>
        <p>
            For SOC in the range \(0 - 100\%\), and table pairs \((s_i, V_i)\):
        </p>
        <p>
        \[
            OCV(s) =
            V_{\text{low}}
            +
            \frac{s - s_{\text{low}}}{s_{\text{high}} - s_{\text{low}}}
            \left(V_{\text{high}} - V_{\text{low}}\right)
        \]
        </p>

        <h3>Updated State</h3>
        <p>
        \[
        y_{\text{new}}
        =
        \begin{bmatrix}
        OCV(100 \cdot SOC) \\
        \dfrac{V_{\text{source}} - V}{R} \\
        R_{\text{new}} \\
        T \\
        SOC \\
        SEI
        \end{bmatrix}
        \]
        </p>
    </section>

    <!-- Charging Policies -->
    <section id="charging-policies-eq">
        <h2>Charging Policies</h2>

        <h3>Constant Voltage (CV)</h3>
        <p>
        \[
            V_{\text{source}} = V_{\text{set}}
        \]
        </p>

        <h3>Constant Current (CC)</h3>
        <p>
        \[
            V_{\text{source}} = \frac{I_{\text{set}}}{R}
        \]
        </p>

        <h3>Pulse Charging</h3>
        <p>
            Let:
        </p>
        <p>
        \[
            t_{\text{cycle}} = t_{\text{on}} + t_{\text{off}}.
        \]
        </p>
        <p>
        \[
            V_{\text{source}}(t)
            =
            \begin{cases}
            \dfrac{I_{\text{set}}}{R}, & (t \bmod t_{\text{cycle}}) < t_{\text{on}} \\[6pt]
            0, & \text{otherwise}
            \end{cases}
        \]
        </p>

        <h3>Sinusoidal Charging</h3>
        <p>
        \[
            V_{\text{source}}(t)
            = \frac{I_{\text{amp}} \sin(2\pi f t)}{R}
        \]
        </p>
    </section>

    <!-- Complete System ODE -->
    <section id="complete-ode">
        <h2>Complete System ODE (As Used in <code>main.py</code>)</h2>

        <p>
            With active mechanisms \(\{\text{Thermo}, \text{Charging}\}\), the system becomes:
        </p>
        <p>
        \[
            \frac{dV}{dt} = 0,\qquad
            \frac{dI}{dt} = 0,\qquad
            \frac{dR}{dt} = 0,
        \]
        </p>
        <p>
        \[
            \frac{dSOC}{dt} = \frac{I}{C_{\text{nominal}} \cdot 3600},
        \]
        </p>
        <p>
        \[
            \frac{dT}{dt} =
            \frac{I^2 R}{m c}
            + \frac{I\,(V_{\text{source}} - V)}{m c}
            - k(T - T_{\text{amb}}),
        \]
        </p>
        <p>
        \[
            \frac{dSEI}{dt} = 0 \quad (\text{unless SEI model is added}).
        \]
        </p>
    </section>

    <footer>
        © 2025 BatterySim ODE Project
    </footer>

    <!-- Scroll-driven charging + reveal -->
    <script>
        document.addEventListener("scroll", () => {
            const scrollY = window.scrollY;
            const docHeight = document.body.scrollHeight - window.innerHeight;
            const progress = docHeight > 0 ? (scrollY / docHeight) * 100 : 0;

            const fill = document.getElementById("charging-fill");
            if (fill) fill.style.height = progress + "%";

            document.querySelectorAll("section").forEach(sec => {
                const rect = sec.getBoundingClientRect();
                if (rect.top < window.innerHeight - 80) {
                    sec.classList.add("visible");
                }
            });
        });

        window.addEventListener("load", () => {
            document.dispatchEvent(new Event("scroll"));
        });
    </script>
</body>
</html>
